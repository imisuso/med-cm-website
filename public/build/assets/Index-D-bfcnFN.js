import{o as n,h as x,d as h,s as M,x as T,r as i,Q as U,T as L,C as N,c as a,a as o,w as y,p as O,u as d,F as k,f as S,D as $,b as _,v as z,e as q,_ as A,k as m,t as H,n as Q,i as R}from"./app-BeH-cH3z.js";import{_ as W}from"./PersonInteractiveCardList-BWqoWLRT.js";import{_ as G}from"./Paginations-CSIau3um.js";import{D as J}from"./DivisionService-BlcX74zp.js";import{t as K}from"./style-C3WfBZxT.js";import{S as X}from"./sweetalert2-z6gKu1nJ.js";import"./EyeIcon-Cf7UK2Nx.js";import"./ToggleSwitch-BGsZa61X.js";function Y(u,f){return n(),x("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})])}const Z={class:"flex flex-col px-2 py-1 w-full"},ee={key:0,class:"flex flex-col sm:flex-row items-start sm:items-center mb-2"},te=["value"],se={class:"flex flex-col sm:flex-row sm:justify-between px-2 py-2 space-y-2 mb-2 w-full border rounded-md shadow-md items-baseline"},oe={class:"flex space-x-2 w-full place-self-center"},ne={key:0,class:"flex space-x-2"},re={class:"flex items-center w-28 py-1 px-3 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-black hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500"},ie={class:"flex flex-col w-full mb-4"},le={class:"flex justify-center md:justify-end mt-2 px-4"},ae={layout:A},de=Object.assign(ae,{__name:"Index",props:{persons:{type:Object,required:!0,default:{}},filters:{type:Object}},setup(u){const f=u;T(()=>{B.value.listAll().then(e=>{p.value=e})});const P="/fallbackimage/default-blank-image.jpg",B=i(new J),p=i([]),v=i(null),C=i(base_url);let r=f.filters.fdivision_selected?i(f.filters.fdivision_selected):i(U().props.auth.division_id),c=i(f.filters.search);const l=L({id:null,fullname:null});N(c,e=>{m.get(route("admin.person"),{search:e,fdivision_selected:r.value},{preserveState:!0,replace:!0})});const w=(e,t,s)=>{K({title:t,description:s},{showIcon:!0,transition:"zoom",position:"top-right",type:e,timeout:3e3})},j=()=>{m.delete(route("admin.person.delete",l.id),{preserveState:!0,onSuccess:()=>{w("success","สำเร็จ","ลบข้อมูลบุคลากร เรียบร้อย")},onError:e=>{let t="";for(let s in e)t=t+`- ${e[s]}<br/>`;w("danger","พบปัญหา",t)},onFinish:()=>{l.processing=!1}})},V=()=>{m.get(route("admin.person"),{fdivision_selected:r.value},{preserveState:!0,replace:!0})},D=e=>{m.get(route("admin.person.view",e.id),{},{preserveState:!0,replace:!0})},F=e=>{m.get(route("admin.person.edit",e.id),{},{preserveState:!0,replace:!0})},I=e=>{v.value=e.image?e.image_url:`${C.value}${P}`,l.id=e.id,l.fullname=`${e.fname_th} ${e.lname_th}`,X.fire({title:"คุณแน่ใจว่าต้องการลบข้อมูลบุคลากร?",text:`${l.fullname}`,imageUrl:v.value,imageWidth:80,imageHeight:80,showCancelButton:!0,confirmButtonColor:"#b91c1c",cancelButtonColor:"#6b7280",confirmButtonText:"ลบ",cancelButtonText:"ยกเลิก"}).then(t=>{t.isConfirmed?j():(l.reset(),v.value=null)})},E=e=>{let t=p.value.filter(s=>s.division_id===e);return t.length>0?t[0].slug:""};return(e,t)=>(n(),a("div",Z,[t[4]||(t[4]=o("div",{class:"mt-2 mb-2 text-2xl font-bold"},"จัดการบุคลากร",-1)),e.$page.props.auth.abilities.includes("view_all_content")?(n(),a("div",ee,[t[2]||(t[2]=o("div",{class:"sm:w-32 text-sm font-medium text-gray-700"},"สาขา/หน่วยงาน:",-1)),y(o("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>$(r)?r.value=s:r=s),onChange:V,id:"form_division_id",class:"mt-1 w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},[(n(!0),a(k,null,S(p.value,(s,g)=>(n(),a("option",{key:g,value:s.division_id},H(s.name_th),9,te))),128))],544),[[O,d(r)]])])):_("",!0),o("div",se,[o("div",oe,[y(o("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>$(c)?c.value=s:c=s),type:"text",id:"search",placeholder:"ค้นหาด้วย ชื่อ หรือ นามสกุล",class:"block mx-1 focus:ring-indigo-500 focus:border-indigo-500 w-full shadow-sm sm:text-sm border-gray-300 rounded-md"},null,512),[[z,d(c)]])]),e.$page.props.auth.abilities.includes("manage_person")?(n(),a("div",ne,[d(r)!=0&&u.persons.total>1?(n(),x(d(R),{key:0,href:e.route("admin.person_order",E(parseInt(d(r))))},{default:q(()=>[o("button",re,[o("div",null,[h(d(Y),{class:Q(["h-6 w-6"])})]),t[3]||(t[3]=o("div",null,"เรียงลำดับ",-1))])]),_:1},8,["href"])):_("",!0)])):_("",!0)]),o("div",ie,[(n(!0),a(k,null,S(u.persons.data,(s,g)=>(n(),x(W,{key:g,personDetails:s,"order-input":!1,onEditPerson:b=>F(s),onViewPerson:b=>D(s),onDeletePerson:b=>I(s)},null,8,["personDetails","onEditPerson","onViewPerson","onDeletePerson"]))),128))]),o("div",le,[h(G,{pagination:u.persons},null,8,["pagination"])])]))}}),xe=M(de,[["__scopeId","data-v-212e2b5d"]]);export{xe as default};
