import{_ as I,r as f,k as O,u as A,p as L,m as S,c as d,o as r,a as t,e as w,t as g,f as k,g as v,b as a,l as j,d as F,w as T,q as Q,F as M,h as C,v as U,s as J}from"./app-B_ehG6JH.js";import{d as b}from"./th-TsgVQkta.js";import{t as P}from"./style-BEfesHTc.js";const R={class:"flex flex-col p-4 w-full"},W={class:"flex flex-col sm:flex-row sm:justify-between px-2 py-2 space-y-2 mb-2 w-full border border-gray-200 rounded-md shadow-md items-baseline"},G={class:"text-2xl font-bold"},K={class:"grid grid-cols-6 gap-2"},X={class:"mt-5 md:mt-0 col-span-6"},Z={class:"shadow-sm overflow-hidden sm:rounded-md"},ee={class:"px-4 py-5 bg-white sm:p-6"},te=["disabled"],oe={class:"grid grid-cols-6 gap-6 mb-6"},se={class:"col-span-6"},ne={key:0,class:"col-span-6"},ie=["value"],le={class:"col-span-6"},ae={key:1,class:"col-span-6"},de={class:"my-1"},re={class:"flex items-center flex-col sm:flex-row justify-between border border-indigo-500 rounded-md"},ce={class:"flex flex-col"},ue={class:"p-2"},me={class:"flex items-center m-2 sm:m-0"},pe=["onClick"],fe={class:"col-span-6"},ge={class:"my-1"},ve={class:"flex items-center flex-col sm:flex-row justify-between border border-indigo-500 rounded-md"},_e={class:"flex flex-col"},be={class:"p-2"},xe={class:"flex items-center m-2 sm:m-0"},he=["id","onChange"],ye=["onClick"],we={class:""},ke={class:"flex flex-row mt-4 space-x-4"},Fe={layout:I},Ve=Object.assign(Fe,{__name:"DataForm",props:{action:{type:String,require:!0,default:"create"},announce:{type:Object},divisions:{type:Array},fdivision_selected:{type:Number}},setup(_){const n=_,x=f(),$=f([["bold","italic","underline","strike"],["blockquote"],[{header:[1,2,3,4,!1]}],[{list:"ordered"},{list:"bullet"}],[{indent:"-1"},{indent:"+1"}],[{color:[]},{background:[]}],["link"],["clean"]]),h=f(null),H=f(!1),N=["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"],q=f(b().startOf("day").toDate()),u=O([]),i=A({id:n.announce?n.announce.id:null,pinned:n.announce?n.announce.pinned:!1,topic:n.announce?n.announce.topic:null,detail_delta:n.announce?.detail_delta?JSON.parse(n.announce.detail_delta):{},expire_date:n.announce?b(n.announce.expire_date).toDate():f(b(q.value).add(30,"day").toDate()),division_id:n.fdivision_selected?n.fdivision_selected:L().props.auth.division_id,type:n.announce?n.announce.type:1,old_attachments:n.announce?n.announce.attach_files.length>0?n.announce.attach_files:[]:[]});switch(n.action){case"create":h.value="เพิ่ม";break;case"edit":h.value="แก้ไข";break;case"view":h.value="ดู";break}const B=()=>{x.value.getQuill().enable(!0)},V=o=>{const e=o.getDate(),l=o.getMonth(),m=o.getFullYear();return`วันที่ ${e} ${N.at(l)} ${m+543}`},z=()=>{u.push({name:"กรุณาเลือกไฟล์",size:0}),J(()=>{var o="file-"+(u.length-1);document.getElementById(o).click()})},y=(o,e)=>{o.splice(e,1)},E=(o,e,l)=>{let m=l.target.files[0];e.File=m,e.name=m.name,e.size=m.size,e.size>1024*1024*5&&(y(u,o),p("warning","พบข้อผิดพลาด","เพิ่มไฟล์แนบไม่ได้ เนื่องจากไฟล์ของคุณใหญ่เกินไป (> 5MB)")),m.type.match("application/pdf")||(y(u,o),p("warning","พบข้อผิดพลาด","เพิ่มไฟล์แนบไม่ได้ เนื่องจากอนุญาตให้แนบไฟล์เฉพาะ PDF เท่านั้น"))},Y=()=>{let o="";i.id?i.transform(e=>({...e,expire_date:b(e.expire_date).format("YYYY-MM-DD HH:mm:ss"),detail_delta:JSON.stringify(e.detail_delta),detail_html:x.value.getHTML(),atFiles:u.map(l=>l.File)})).post(route("admin.announce.update",i.id),{_method:"patch",preserveState:!1,onSuccess:()=>{p("success","แก้ไขสำเร็จ","แก้ไขข้อมูลประกาศ เรียบร้อย")},onError:e=>{for(let l in e)o=o+`- ${e[l]}<br/>`;p("danger","พบข้อผิดพลาด",o)},onFinish:()=>{i.processing=!1}}):i.transform(e=>({...e,expire_date:b(e.expire_date).format("YYYY-MM-DD HH:mm:ss"),detail_delta:JSON.stringify(e.detail_delta),detail_html:x.value.getHTML(),atFiles:u.map(l=>l.File)})).post(route("admin.announce.store"),{preserveState:!1,onSuccess:()=>{p("success","สำเร็จ","จัดเก็บประกาศเรียบร้อย")},onError:e=>{for(let l in e)o=o+`- ${e[l]}<br/>`;p("danger","พบข้อผิดพลาด",o)},onFinish:()=>{i.processing=!1}}),u.splice(0)},p=(o,e,l)=>{P({title:e,description:l},{showIcon:!0,transition:"zoom",position:"top-right",type:o,timeout:3e3})};return(o,e)=>{const l=S("Datepicker"),m=S("QuillEditor");return r(),d("div",R,[t("div",W,[t("div",G,g(h.value)+"ข้อมูลข่าวประกาศ",1),w(a(j),{href:o.route("admin.announce"),data:{fdivision_selected:_.fdivision_selected},method:"get",as:"button",type:"button",class:"px-3 py-1 text-sm font-bold text-gray-100 transition-colors duration-200 transform bg-green-900 rounded-sm cursor-pointer hover:bg-green-800"},{default:k(()=>e[4]||(e[4]=[v(" กลับหน้าหลัก ",-1)])),_:1,__:[4]},8,["href","data"])]),e[17]||(e[17]=t("div",{class:"text-gray-900 text-lg underline font-medium dark:text-white mb-4"}," รายละเอียดข้อมูลข่าวประกาศ ",-1)),t("div",K,[t("div",X,[t("div",Z,[t("div",ee,[t("fieldset",{disabled:H.value},[t("div",oe,[t("div",se,[e[5]||(e[5]=t("label",{for:"topic",class:"block text-sm font-medium text-gray-700 mb-2"},"วันที่ประกาศหมดอายุ",-1)),w(l,{"menu-class-name":"shadow-lg shadow-stone-800/50",placeholder:"default 30 วัน",modelValue:a(i).expire_date,"onUpdate:modelValue":e[0]||(e[0]=s=>a(i).expire_date=s),locale:"th",cancelText:"ยกเลิก",selectText:"เลือก",yearRange:[new Date().getFullYear()-2,new Date().getFullYear()+5],enableTimePicker:!1,format:V,previewFormat:V,minDate:new Date,clearable:!1,autoApply:""},{year:k(({value:s})=>[v(g(parseInt(s)+543),1)]),"year-overlay-value":k(({text:s,value:c})=>[v(g(parseInt(s)+543),1)]),_:1},8,["modelValue","yearRange","minDate"])]),o.$page.props.auth.abilities.includes("view_all_content")?(r(),d("div",ne,[e[7]||(e[7]=t("label",{for:"division_selected",class:"block text-sm font-medium text-gray-700"},"สาขา/หน่วยงาน",-1)),T(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>a(i).division_id=s),id:"division_selected",class:"mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-xs focus:outline-hidden focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},[e[6]||(e[6]=t("option",{value:"0"},"ตามสาขา/หน่วยงานผู้ประกาศ",-1)),(r(!0),d(M,null,C(_.divisions,(s,c)=>(r(),d("option",{key:c,value:s.division_id},g(s.name_th),9,ie))),128))],512),[[Q,a(i).division_id]])])):F("",!0),t("div",le,[e[8]||(e[8]=t("div",{class:"flex items-center justify-between"},[t("label",{for:"topic",class:"block text-sm font-medium text-gray-700"},"หัวข้อข่าว")],-1)),T(t("input",{type:"text",id:"topic","onUpdate:modelValue":e[2]||(e[2]=s=>a(i).topic=s),class:"mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-xs sm:text-sm border-gray-300 rounded-md"},null,512),[[U,a(i).topic,void 0,{trim:!0}]])]),a(i).old_attachments?(r(),d("div",ae,[t("ul",null,[(r(!0),d(M,null,C(a(i).old_attachments,(s,c)=>(r(),d("li",{key:c},[t("div",de,[t("div",re,[t("div",ce,[t("div",ue,[e[9]||(e[9]=t("strong",null,"ชื่อไฟล์ : ",-1)),v(g(s.orig_name),1)])]),t("div",me,[t("a",{href:"#",onClick:D=>y(a(i).old_attachments,c),class:"flex items-center text-sm text-red-600 px-2 py-2"},e[10]||(e[10]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 hover:fill-current",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)]),8,pe)])])])]))),128))])])):F("",!0),t("div",fe,[t("ul",null,[(r(!0),d(M,null,C(u,(s,c)=>(r(),d("li",{key:c},[t("div",ge,[t("div",ve,[t("div",_e,[t("div",be,[e[11]||(e[11]=t("strong",null,"ชื่อไฟล์ : ",-1)),v(g(s.name),1)])]),t("div",xe,[t("label",null,[e[12]||(e[12]=t("span",{class:"p-2 mt-2 text-sm cursor-pointer rounded-lg shadow-lg border text-white border-indigo-500 bg-blue-700 hover:bg-blue-800 hover:text-white"},"เลือกไฟล์",-1)),t("input",{id:"file-"+c,type:"file",accept:".pdf",onChange:D=>E(c,s,D),style:{display:"none"}},null,40,he)]),t("a",{href:"#",onClick:D=>y(u,c),class:"flex items-center text-sm text-red-600 px-2 py-2"},e[13]||(e[13]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 hover:fill-current",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)]),8,ye)])])])]))),128))]),t("a",{href:"#",onClick:z,class:"add"},e[14]||(e[14]=[t("div",{class:"text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center"}," เพิ่มไฟล์แนบ ",-1)]))])])],8,te)])])])]),t("div",we,[e[15]||(e[15]=t("label",{for:"topic",class:"block text-sm font-medium text-gray-700 mt-2 mb-2"},"เนื้อหาข่าวประกาศ",-1)),w(m,{id:"quill_e",ref_key:"quill_e",ref:x,theme:"snow",content:a(i).detail_delta,"onUpdate:content":e[3]||(e[3]=s=>a(i).detail_delta=s),contentType:"delta",toolbar:$.value,onReady:B},null,8,["content","toolbar"])]),t("div",ke,[_.action==="create"?(r(),d("button",{key:0,type:"button",onClick:Y,class:"text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center"},"จัดเก็บ")):F("",!0),_.action==="edit"?(r(),d("button",{key:1,type:"button",onClick:Y,class:"text-white bg-orange-700 hover:bg-orange-800 focus:ring-4 focus:ring-orange-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center"},"แก้ไข")):F("",!0),w(a(j),{href:o.route("admin.announce"),data:{fdivision_selected:a(i).division_id},method:"get",as:"button",type:"button",class:"text-gray-500 bg-white hover:bg-gray-100 focus:ring-4 focus:ring-gray-300 rounded-lg border border-gray-200 text-sm font-medium px-5 py-2.5 hover:text-gray-900 focus:z-10"},{default:k(()=>e[16]||(e[16]=[v(" ยกเลิก ",-1)])),_:1,__:[16]},8,["href","data"])])])}}});export{Ve as default};
