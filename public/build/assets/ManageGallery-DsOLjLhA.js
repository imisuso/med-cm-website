import{r as p,u as C,c as g,o as c,a as t,n as m,t as v,F as b,h as x,e as S}from"./app-B_ehG6JH.js";import{T as B}from"./ToggleSwitch-SZAZXQvA.js";import{t as j}from"./style-BEfesHTc.js";const q={class:"m-4"},I={class:"flex flex-col space-y-4"},z={class:"flex items-center space-x-4"},M={class:"mt-1 flex items-center"},$=["disabled"],A={class:"text-xl font-bold underline"},N={class:"flex flex-col border border-dashed border-blue-500 p-4 rounded-md"},T={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-2 mt-4"},E=["src"],U=["onClick"],V={class:"flex flex-col border border-dashed border-green-600 p-4 rounded-md mt-4"},D={class:"flex flex-col md:flex-row items-center justify-between"},L={class:"text-lg font-bold"},R={class:"flex flex-row"},G={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-2 mt-4"},H=["src"],J=["onClick"],Q={__name:"ManageGallery",props:{id:{type:Number,required:!0,default:0},slug:{type:String,required:!0,default:""},desc:{type:String,required:!0,default:""},event_date:{type:String,required:!0,default:""},images:{type:Array,required:!0,default:[]},limit:{type:Number,require:!0}},setup(a){const h=a,n=p(h.limit),u=p(!1),r=p([]),i=C({id:h.id,desc:h.desc,event_date:h.event_date}),d=(l,e,s)=>{j({title:e,description:s},{showIcon:!0,transition:"zoom",position:"top-right",type:l,timeout:3e3})},_=l=>{var e=l.target.files||l.dataTransfer.files;if(e.length){if(e[0].size>1024*1024*2){d("warning","คำเตือน","เพิ่มไฟล์รูปไม่ได้ เนื่องจากไฟล์ของคุณมีขนาดใหญ่กว่า 2MB");return}if(!e[0].type.match("image/jp.*")){d("warning","คำเตือน","เพิ่มไฟล์รูปไม่ได้ อนุญาตให้แนบไฟล์เฉพาะ .jpg เท่านั้น");return}y(e)}},y=l=>{for(var e=0;e<l.length;e++){var s=new FileReader;s.onload=function(o){const f=o.target.result;r.value.push({file_url:f,File:l[0]})},s.readAsDataURL(l[e])}},w=l=>{r.value.splice(l,1)},k=()=>{i.transform(l=>({...l,imageFiles:r.value.map(e=>e.File)})).post(route("admin.gallery.upload_image_to_gallery",i.id),{_method:"patch",preserveState:!0,only:["images"],onSuccess:()=>{d("success","สำเร็จ","อัพโหลดรูปเข้าแกลลอรี่ เรียบร้อย"),i.reset()},onError:l=>{let e="";for(let s in l)e=e+`- ${l[s]}<br/>`;d("danger","พบข้อผิดพลาด",e)},onFinish:()=>{i.processing=!1}}),r.value.splice(0)},F=l=>{i.transform(e=>({...e,file_path:l})).delete(route("admin.gallery.delete_image"),{preserveState:!0,only:["images"],onSuccess:()=>{d("success","สำเร็จ","ทำการลบรูปจากแกลลอรี่ เรียบร้อย"),i.reset()},onError:e=>{let s="";for(let o in e)s=s+`- ${e[o]}<br/>`;d("danger","พบข้อผิดพลาด",s)},onFinish:()=>{i.processing=!1}})};return(l,e)=>(c(),g("div",q,[t("div",I,[t("div",z,[t("div",M,[t("label",{class:m([{"cursor-not-allowed":r.value.length>=4||a.images.length>=n.value},"flex flex-col w-24 items-center mx-2 px-2 bg-white text-blue-400 rounded-lg shadow-lg tracking-wide uppercase border border-blue-400 cursor-pointer hover:bg-blue-400 hover:text-white"])},[e[2]||(e[2]=t("svg",{class:"w-6 h-6",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20"},[t("path",{d:"M16.88 9.1A4 4 0 0 1 16 17H5a5 5 0 0 1-1-9.9V7a3 3 0 0 1 4.52-2.59A4.98 4.98 0 0 1 17 8c0 .38-.04.74-.12 1.1zM11 11h3l-4-4-4 4h3v3h2v-3z"})],-1)),e[3]||(e[3]=t("span",{class:"mt-2 text-base leading-normal"},"เลือกรูป",-1)),t("input",{type:"file",accept:"image/jpeg",onChange:_,class:"hidden",disabled:r.value.length>=4||a.images.length>=n.value},null,40,$)],2)]),t("div",A,v(a.desc),1)]),t("div",N,[e[4]||(e[4]=t("div",{class:"text-lg font-bold"},"ส่วนแสดงรูปก่อนทำการอัพโหลด",-1)),e[5]||(e[5]=t("div",{class:"text-sm text-gray-600"},"*** หมายเหตุ รูปต้องเป็นประเภท .jpg หรือ .jpeg เท่านั้น และต้องมีขนาดไม่เกิน 2 MB ต่อรูป",-1)),t("div",T,[(c(!0),g(b,null,x(r.value,(s,o)=>(c(),g("div",{key:o},[t("img",{class:"rounded-md shadow-md",src:s.file_url},null,8,E),t("button",{class:"p-1 border rounded-md bg-red-700 hover:bg-red-500 text-white hover:text-black",onClick:f=>w(o)},"ลบรูปที่ "+v(o+1),9,U)]))),128))])]),t("a",{class:m({hidden:!r.value.length||r.value.length>4||r.value.length+a.images.length>n.value}),href:"#",onClick:k},e[6]||(e[6]=[t("div",{class:"text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center"}," อัพโหลด ",-1)]),2),t("div",{class:m([{hidden:r.value.length&&r.value.length<=4},"text-red-600 font-bold"])},"กรุณาเลือกรูปอย่างน้อย 1 รูป และไม่เกิน 4 รูปต่อการอัพโหลด 1 ครั้ง",2),t("div",{class:m([{hidden:r.value.length+a.images.length<=n.value},"text-red-600 text-sm"])},"*** เกินจำนวนรูปสูงสุดที่จะเก็บลงใน gallery",2)]),t("div",V,[t("div",D,[t("div",L,"รูปที่ถูกอัพโหลดเข้าแกลลอรี่แล้ว ( "+v(a.images.length)+"/"+v(n.value)+" )",1),t("div",R,[e[7]||(e[7]=t("div",null,"เปิด/ปิด การลบรูป",-1)),S(B,{status:u.value,"onUpdate:status":e[0]||(e[0]=s=>u.value=s),onButtonIsToggle:e[1]||(e[1]=s=>u.value=!u.value)},null,8,["status"])])]),t("div",G,[(c(!0),g(b,null,x(a.images,(s,o)=>(c(),g("div",{key:o},[t("img",{class:"rounded-md shadow-md w-full h-40",src:s.image_url,alt:""},null,8,H),t("button",{class:m([{hidden:!u.value},"p-1 border rounded-md bg-red-700 hover:bg-red-500 text-white hover:text-black"]),onClick:f=>F(s.image_path)},"ลบรูปที่ "+v(o+1),11,J)]))),128))])])]))}};export{Q as default};
