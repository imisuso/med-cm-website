import{i as x,o as r,e as h,x as M,_ as U,y as L,r as i,p as N,u as O,D as T,j as m,c as a,a as o,d as _,w as y,q,b as d,F as k,h as S,t as z,E as P,v as A,f as H,n as R,l as W}from"./app-in0725Sj.js";import{_ as G}from"./PersonInteractiveCardList-C9Cq29jO.js";import{_ as J}from"./Paginations-05jB3uYv.js";import{D as K}from"./DivisionService-C51AC8oG.js";import{t as Q}from"./style-D_zxMGF0.js";import{S as X}from"./sweetalert2-z6gKu1nJ.js";import"./EyeIcon-BX1yCgCg.js";import"./ToggleSwitch-BX05i7hr.js";function Y(u,f){return r(),x("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})])}const Z={class:"flex flex-col px-2 py-1 w-full"},ee={key:0,class:"flex flex-col sm:flex-row items-start sm:items-center mb-2"},te=["value"],se={class:"flex flex-col sm:flex-row sm:justify-between px-2 py-2 space-y-2 mb-2 w-full border border-gray-200 rounded-md shadow-md items-baseline"},oe={class:"flex space-x-2 w-full place-self-center"},re={key:0,class:"flex space-x-2"},ne={class:"flex items-center w-28 py-1 px-3 border border-transparent shadow-xs text-sm font-medium rounded-md text-white bg-black hover:bg-gray-700 focus:outline-hidden focus:ring-2 focus:ring-offset-2 focus:ring-gray-500"},ie={class:"flex flex-col w-full mb-4"},le={class:"flex justify-center md:justify-end mt-2 px-4"},ae={layout:U},de=Object.assign(ae,{__name:"Index",props:{persons:{type:Object,required:!0,default:{}},filters:{type:Object}},setup(u){const f=u;L(()=>{B.value.listAll().then(e=>{p.value=e})});const $="/fallbackimage/default-blank-image.jpg",B=i(new K),p=i([]),v=i(null),j=i(base_url);let n=f.filters.fdivision_selected?i(f.filters.fdivision_selected):i(N().props.auth.division_id),c=i(f.filters.search);const l=O({id:null,fullname:null});T(c,e=>{m.get(route("admin.person"),{search:e,fdivision_selected:n.value},{preserveState:!0,replace:!0})});const w=(e,t,s)=>{Q({title:t,description:s},{showIcon:!0,transition:"zoom",position:"top-right",type:e,timeout:3e3})},C=()=>{m.delete(route("admin.person.delete",l.id),{preserveState:!0,onSuccess:()=>{w("success","สำเร็จ","ลบข้อมูลบุคลากร เรียบร้อย")},onError:e=>{let t="";for(let s in e)t=t+`- ${e[s]}<br/>`;w("danger","พบปัญหา",t)},onFinish:()=>{l.processing=!1}})},V=()=>{m.get(route("admin.person"),{fdivision_selected:n.value},{preserveState:!0,replace:!0})},D=e=>{m.get(route("admin.person.view",e.id),{},{preserveState:!0,replace:!0})},F=e=>{m.get(route("admin.person.edit",e.id),{},{preserveState:!0,replace:!0})},I=e=>{v.value=e.image?e.image_url:`${j.value}${$}`,l.id=e.id,l.fullname=`${e.fname_th} ${e.lname_th}`,X.fire({title:"คุณแน่ใจว่าต้องการลบข้อมูลบุคลากร?",text:`${l.fullname}`,imageUrl:v.value,imageWidth:80,imageHeight:80,showCancelButton:!0,confirmButtonColor:"#b91c1c",cancelButtonColor:"#6b7280",confirmButtonText:"ลบ",cancelButtonText:"ยกเลิก"}).then(t=>{t.isConfirmed?C():(l.reset(),v.value=null)})},E=e=>{let t=p.value.filter(s=>s.division_id===e);return t.length>0?t[0].slug:""};return(e,t)=>(r(),a("div",Z,[t[4]||(t[4]=o("div",{class:"mt-2 mb-2 text-2xl font-bold"},"จัดการบุคลากร",-1)),e.$page.props.auth.abilities.includes("view_all_content")?(r(),a("div",ee,[t[2]||(t[2]=o("div",{class:"sm:w-32 text-sm font-medium text-gray-700"},"สาขา/หน่วยงาน:",-1)),y(o("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>P(n)?n.value=s:n=s),onChange:V,id:"form_division_id",class:"mt-1 w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-xs focus:outline-hidden focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},[(r(!0),a(k,null,S(p.value,(s,g)=>(r(),a("option",{key:g,value:s.division_id},z(s.name_th),9,te))),128))],544),[[q,d(n)]])])):_("",!0),o("div",se,[o("div",oe,[y(o("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>P(c)?c.value=s:c=s),type:"text",id:"search",placeholder:"ค้นหาด้วย ชื่อ หรือ นามสกุล",class:"block mx-1 focus:ring-indigo-500 focus:border-indigo-500 w-full shadow-xs sm:text-sm border-gray-300 rounded-md"},null,512),[[A,d(c)]])]),e.$page.props.auth.abilities.includes("manage_person")?(r(),a("div",re,[d(n)!=0&&u.persons.total>1?(r(),x(d(W),{key:0,href:e.route("admin.person_order",E(parseInt(d(n))))},{default:H(()=>[o("button",ne,[o("div",null,[h(d(Y),{class:R(["h-6 w-6"])})]),t[3]||(t[3]=o("div",null,"เรียงลำดับ",-1))])]),_:1},8,["href"])):_("",!0)])):_("",!0)]),o("div",ie,[(r(!0),a(k,null,S(u.persons.data,(s,g)=>(r(),x(G,{key:g,personDetails:s,"order-input":!1,onEditPerson:b=>F(s),onViewPerson:b=>D(s),onDeletePerson:b=>I(s)},null,8,["personDetails","onEditPerson","onViewPerson","onDeletePerson"]))),128))]),o("div",le,[h(J,{pagination:u.persons},null,8,["pagination"])])]))}}),xe=M(de,[["__scopeId","data-v-c7f05579"]]);export{xe as default};
