import{r as f,l as O,T as A,Q as L,m as T,c as d,a as t,t as g,d as w,e as k,u as a,w as j,p as Q,F as M,f as C,b as D,v as U,_ as J,q as R,o as r,g as v,i as $}from"./app-BriM7XSz.js";import{d as _}from"./th-8fjS_Dff.js";import{t as P}from"./style-BWAxEyHM.js";const W={class:"flex flex-col p-4 w-full"},G={class:"flex flex-col sm:flex-row sm:justify-between px-2 py-2 space-y-2 mb-2 w-full border rounded-md shadow-md items-baseline"},K={class:"text-2xl font-bold"},X={class:"grid grid-cols-6 gap-2"},Z={class:"mt-5 md:mt-0 col-span-6"},ee={class:"shadow overflow-hidden sm:rounded-md"},te={class:"px-4 py-5 bg-white sm:p-6"},oe=["disabled"],se={class:"grid grid-cols-6 gap-6 mb-6"},ne={class:"col-span-6"},ie={key:0,class:"col-span-6"},le=["value"],ae={class:"col-span-6"},de={key:1,class:"col-span-6"},re={class:"my-1"},ce={class:"flex items-center flex-col sm:flex-row justify-between border border-indigo-500 rounded-md"},ue={class:"flex flex-col"},me={class:"p-2"},pe={class:"flex items-center m-2 sm:m-0"},fe=["onClick"],ge={class:"col-span-6"},ve={class:"my-1"},be={class:"flex items-center flex-col sm:flex-row justify-between border border-indigo-500 rounded-md"},_e={class:"flex flex-col"},xe={class:"p-2"},he={class:"flex items-center m-2 sm:m-0"},ye=["id","onChange"],we=["onClick"],ke={class:""},De={class:"flex flex-row mt-4 space-x-4"},Fe={layout:J},Ye=Object.assign(Fe,{__name:"DataForm",props:{action:{type:String,require:!0,default:"create"},announce:{type:Object},divisions:{type:Array},fdivision_selected:{type:Number}},setup(b){var S;const n=b,x=f(),H=f([["bold","italic","underline","strike"],["blockquote"],[{header:[1,2,3,4,!1]}],[{list:"ordered"},{list:"bullet"}],[{indent:"-1"},{indent:"+1"}],[{color:[]},{background:[]}],["link"],["clean"]]),h=f(null),N=f(!1),q=["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"],B=f(_().startOf("day").toDate()),u=O([]),i=A({id:n.announce?n.announce.id:null,pinned:n.announce?n.announce.pinned:!1,topic:n.announce?n.announce.topic:null,detail_delta:(S=n.announce)!=null&&S.detail_delta?JSON.parse(n.announce.detail_delta):{},expire_date:n.announce?_(n.announce.expire_date).toDate():f(_(B.value).add(30,"day").toDate()),division_id:n.fdivision_selected?n.fdivision_selected:L().props.auth.division_id,type:n.announce?n.announce.type:1,old_attachments:n.announce?n.announce.attach_files.length>0?n.announce.attach_files:[]:[]});switch(n.action){case"create":h.value="เพิ่ม";break;case"edit":h.value="แก้ไข";break;case"view":h.value="ดู";break}const z=()=>{x.value.getQuill().enable(!0)},V=o=>{const e=o.getDate(),l=o.getMonth(),m=o.getFullYear();return`วันที่ ${e} ${q.at(l)} ${m+543}`},E=()=>{u.push({name:"กรุณาเลือกไฟล์",size:0}),R(()=>{var o="file-"+(u.length-1);document.getElementById(o).click()})},y=(o,e)=>{o.splice(e,1)},I=(o,e,l)=>{let m=l.target.files[0];e.File=m,e.name=m.name,e.size=m.size,e.size>1024*1024*5&&(y(u,o),p("warning","พบข้อผิดพลาด","เพิ่มไฟล์แนบไม่ได้ เนื่องจากไฟล์ของคุณใหญ่เกินไป (> 5MB)")),m.type.match("application/pdf")||(y(u,o),p("warning","พบข้อผิดพลาด","เพิ่มไฟล์แนบไม่ได้ เนื่องจากอนุญาตให้แนบไฟล์เฉพาะ PDF เท่านั้น"))},Y=()=>{let o="";i.id?i.transform(e=>({...e,expire_date:_(e.expire_date).format("YYYY-MM-DD HH:mm:ss"),detail_delta:JSON.stringify(e.detail_delta),detail_html:x.value.getHTML(),atFiles:u.map(l=>l.File)})).post(route("admin.announce.update",i.id),{_method:"patch",preserveState:!1,onSuccess:()=>{p("success","แก้ไขสำเร็จ","แก้ไขข้อมูลประกาศ เรียบร้อย")},onError:e=>{for(let l in e)o=o+`- ${e[l]}<br/>`;p("danger","พบข้อผิดพลาด",o)},onFinish:()=>{i.processing=!1}}):i.transform(e=>({...e,expire_date:_(e.expire_date).format("YYYY-MM-DD HH:mm:ss"),detail_delta:JSON.stringify(e.detail_delta),detail_html:x.value.getHTML(),atFiles:u.map(l=>l.File)})).post(route("admin.announce.store"),{preserveState:!1,onSuccess:()=>{p("success","สำเร็จ","จัดเก็บประกาศเรียบร้อย")},onError:e=>{for(let l in e)o=o+`- ${e[l]}<br/>`;p("danger","พบข้อผิดพลาด",o)},onFinish:()=>{i.processing=!1}}),u.splice(0)},p=(o,e,l)=>{P({title:e,description:l},{showIcon:!0,transition:"zoom",position:"top-right",type:o,timeout:3e3})};return(o,e)=>{const l=T("Datepicker"),m=T("QuillEditor");return r(),d("div",W,[t("div",G,[t("div",K,g(h.value)+"ข้อมูลข่าวประกาศ",1),w(a($),{href:o.route("admin.announce"),data:{fdivision_selected:b.fdivision_selected},method:"get",as:"button",type:"button",class:"px-3 py-1 text-sm font-bold text-gray-100 transition-colors duration-200 transform bg-green-900 rounded cursor-pointer hover:bg-green-800"},{default:k(()=>e[4]||(e[4]=[v(" กลับหน้าหลัก ")])),_:1},8,["href","data"])]),e[17]||(e[17]=t("div",{class:"text-gray-900 text-lg underline font-medium dark:text-white mb-4"}," รายละเอียดข้อมูลข่าวประกาศ ",-1)),t("div",X,[t("div",Z,[t("div",ee,[t("div",te,[t("fieldset",{disabled:N.value},[t("div",se,[t("div",ne,[e[5]||(e[5]=t("label",{for:"topic",class:"block text-sm font-medium text-gray-700 mb-2"},"วันที่ประกาศหมดอายุ",-1)),w(l,{"menu-class-name":"shadow-lg shadow-stone-800/50",placeholder:"default 30 วัน",modelValue:a(i).expire_date,"onUpdate:modelValue":e[0]||(e[0]=s=>a(i).expire_date=s),locale:"th",cancelText:"ยกเลิก",selectText:"เลือก",yearRange:[new Date().getFullYear()-2,new Date().getFullYear()+5],enableTimePicker:!1,format:V,previewFormat:V,minDate:new Date,clearable:!1,autoApply:""},{year:k(({value:s})=>[v(g(parseInt(s)+543),1)]),"year-overlay-value":k(({text:s,value:c})=>[v(g(parseInt(s)+543),1)]),_:1},8,["modelValue","yearRange","minDate"])]),o.$page.props.auth.abilities.includes("view_all_content")?(r(),d("div",ie,[e[7]||(e[7]=t("label",{for:"division_selected",class:"block text-sm font-medium text-gray-700"},"สาขา/หน่วยงาน",-1)),j(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>a(i).division_id=s),id:"division_selected",class:"mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"},[e[6]||(e[6]=t("option",{value:"0"},"ตามสาขา/หน่วยงานผู้ประกาศ",-1)),(r(!0),d(M,null,C(b.divisions,(s,c)=>(r(),d("option",{key:c,value:s.division_id},g(s.name_th),9,le))),128))],512),[[Q,a(i).division_id]])])):D("",!0),t("div",ae,[e[8]||(e[8]=t("div",{class:"flex items-center justify-between"},[t("label",{for:"topic",class:"block text-sm font-medium text-gray-700"},"หัวข้อข่าว")],-1)),j(t("input",{type:"text",id:"topic","onUpdate:modelValue":e[2]||(e[2]=s=>a(i).topic=s),class:"mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"},null,512),[[U,a(i).topic,void 0,{trim:!0}]])]),a(i).old_attachments?(r(),d("div",de,[t("ul",null,[(r(!0),d(M,null,C(a(i).old_attachments,(s,c)=>(r(),d("li",{key:c},[t("div",re,[t("div",ce,[t("div",ue,[t("div",me,[e[9]||(e[9]=t("strong",null,"ชื่อไฟล์ : ",-1)),v(g(s.orig_name),1)])]),t("div",pe,[t("a",{href:"#",onClick:F=>y(a(i).old_attachments,c),class:"flex items-center text-sm text-red-600 px-2 py-2"},e[10]||(e[10]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 hover:fill-current",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)]),8,fe)])])])]))),128))])])):D("",!0),t("div",ge,[t("ul",null,[(r(!0),d(M,null,C(u,(s,c)=>(r(),d("li",{key:c},[t("div",ve,[t("div",be,[t("div",_e,[t("div",xe,[e[11]||(e[11]=t("strong",null,"ชื่อไฟล์ : ",-1)),v(g(s.name),1)])]),t("div",he,[t("label",null,[e[12]||(e[12]=t("span",{class:"p-2 mt-2 text-sm cursor-pointer rounded-lg shadow-lg border text-white border-indigo-500 bg-blue-700 hover:bg-blue-800 hover:text-white"},"เลือกไฟล์",-1)),t("input",{id:"file-"+c,type:"file",accept:".pdf",onChange:F=>I(c,s,F),style:{display:"none"}},null,40,ye)]),t("a",{href:"#",onClick:F=>y(u,c),class:"flex items-center text-sm text-red-600 px-2 py-2"},e[13]||(e[13]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 hover:fill-current",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)]),8,we)])])])]))),128))]),t("a",{href:"#",onClick:E,class:"add"},e[14]||(e[14]=[t("div",{class:"text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center"}," เพิ่มไฟล์แนบ ",-1)]))])])],8,oe)])])])]),t("div",ke,[e[15]||(e[15]=t("label",{for:"topic",class:"block text-sm font-medium text-gray-700 mt-2 mb-2"},"เนื้อหาข่าวประกาศ",-1)),w(m,{id:"quill_e",ref_key:"quill_e",ref:x,theme:"snow",content:a(i).detail_delta,"onUpdate:content":e[3]||(e[3]=s=>a(i).detail_delta=s),contentType:"delta",toolbar:H.value,onReady:z},null,8,["content","toolbar"])]),t("div",De,[b.action==="create"?(r(),d("button",{key:0,type:"button",onClick:Y,class:"text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center"},"จัดเก็บ")):D("",!0),b.action==="edit"?(r(),d("button",{key:1,type:"button",onClick:Y,class:"text-white bg-orange-700 hover:bg-orange-800 focus:ring-4 focus:ring-orange-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center"},"แก้ไข")):D("",!0),w(a($),{href:o.route("admin.announce"),data:{fdivision_selected:a(i).division_id},method:"get",as:"button",type:"button",class:"text-gray-500 bg-white hover:bg-gray-100 focus:ring-4 focus:ring-gray-300 rounded-lg border border-gray-200 text-sm font-medium px-5 py-2.5 hover:text-gray-900 focus:z-10"},{default:k(()=>e[16]||(e[16]=[v(" ยกเลิก ")])),_:1},8,["href","data"])])])}}});export{Ye as default};
